# ---- Scheduling / placement ----
labels:
  openvswitch:
    node_selector_key: openvswitch
    node_selector_value: enabled

# If your controllers are tainted (control-plane), let OVS run there too
pod:
  tolerations:
    openvswitch:
      tolerations:
        - key: "node-role.kubernetes.io/control-plane"
          operator: "Exists"
          effect: "NoSchedule"
  security_context:
  ovs:
    pod:
      runAsUser: 42424
      fsGroup: 42424
      fsGroupChangePolicy: "OnRootMismatch"
    container:
      perms:
        runAsUser: 0                    # init runs as root to chown/chmod
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
      server:
        runAsUser: 42424                # non-root for ovsdb-server
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
      vswitchd:
        runAsUser: 0
        capabilities:
          add: ["NET_ADMIN"]
        readOnlyRootFilesystem: true
      modules:
        runAsUser: 0
        capabilities:
          add: ["SYS_MODULE","SYS_CHROOT"]
        readOnlyRootFilesystem: true

# ---- Images (use Jammy/Noble to avoid glibc mismatch) ----
images:
  tags:
    openvswitch_db_server: docker.io/openstackhelm/openvswitch:latest-ubuntu_focal
    openvswitch_vswitchd: docker.io/openstackhelm/openvswitch:latest-ubuntu_focal
    dep_check: quay.io/airshipit/kubernetes-entrypoint:latest-ubuntu_focal
    image_repo_sync: docker.io/library/docker:17.07.0 
