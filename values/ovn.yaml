# Use eth2 IP as the OVN Geneve encap IP on each node
images:
  tags:
    ovn_ovsdb_nb: docker.io/openstackhelm/ovn:ubuntu_jammy
    ovn_ovsdb_sb: docker.io/openstackhelm/ovn:ubuntu_jammy
    ovn_northd: docker.io/openstackhelm/ovn:ubuntu_jammy
    ovn_controller: docker.io/openstackhelm/ovn:ubuntu_jammy
    ovn_controller_kubectl: docker.io/openstackhelm/ceph-config-helper:latest-ubuntu_jammy
    dep_check: quay.io/airshipit/kubernetes-entrypoint:latest-ubuntu_focal
    image_repo_sync: docker.io/library/docker:17.07.0
    vector: docker.io/timberio/vector:0.39.0-debian
    ovn_logging_parser: docker.io/openstackhelm/neutron:2025.1-ubuntu_noble 

network:
  interface:
    tunnel: eth2            # chart derives ovn-encap-ip from this
  external:
    bridge:
      name: br-ex
    interface: eth1         # enslave eth1 into br-ex for provider nets

labels:
  ovn_ovsdb_nb:
    node_selector_key: openstack-network-node
    node_selector_value: enabled
  ovn_ovsdb_sb:
    node_selector_key: openstack-network-node
    node_selector_value: enabled
  ovn_northd:
    node_selector_key: openstack-network-node
    node_selector_value: enabled
  ovn_controller:
    node_selector_key: openvswitch
    node_selector_value: enabled
  ovn_controller_gw:
    node_selector_key: l3-agent
    node_selector_value: enabled

conf:
  ovn:
    # Bridge→physnet mapping for provider networks
    # The infra chart will program:
    #   - external-ids:ovn-bridge-mappings=physnet1:br-ex
    #   - external-ids:ovn-encap-type=geneve
    #   - external-ids:ovn-encap-ip=<IP on eth2>
    bridge_mappings: "physnet1:br-ex"
    bridge_interface_mappings: "br-ex:eth1"

  # Optional: set MTU for Geneve overlay
  mtu:
    geneve: 1450

manifests:
  # Central components
  deployment_ovn_northd: true
  statefulset_ovn_nb_db: true
  statefulset_ovn_sb_db: true
  service_ovn_nb: true
  service_ovn_sb: true

  # Controllers on all (compute+controller) nodes
  daemonset_ovn_controller: true

dependencies:
  dynamic:
    service:
      - type: service
        namespace: openstack
        name: ovn-ovsdb-sb
        required: true
    pod:
      - type: pod
        namespace: osh-infra        # <— OVS runs here
        same_host: true
        required: true
        labels:
          application: openvswitch
          component: server         # confirm this label below
  custom_resources: []
